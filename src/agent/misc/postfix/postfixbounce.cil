;; SPDX-FileCopyrightText: Â© 2021 Dominick Grift <dominick.grift@defensec.nl>
;; SPDX-License-Identifier: Unlicense

(in postfix.bounce

    (blockinherit .agent.template)

    (allow subj self (tcp_socket (create)))

    (call defer.spool.manage_file_dirs (subj))
    (call defer.spool.manage_file_files (subj))

    (call incoming.spool.readwrite_file_files (subj))

    (call master.agent (subj exec.file))
    (call master.unix_stream_connect_public (subj))

    (call spool.manage_file_files (subj))
    (call spool.readwrite_file_dirs (subj))

    (call .rbacsep.constrained.type (subj))
    (call .rbacsep.usefdsource.type (subj))

    (block exec

	   (filecon "/usr/bin/bounce" file file_context)))
