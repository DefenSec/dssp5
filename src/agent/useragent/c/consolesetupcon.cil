;; SPDX-FileCopyrightText: Â© 2021 Dominick Grift <dominick.grift@defensec.nl>
;; SPDX-License-Identifier: Unlicense

(in consolesetup

    (block setupcon

	   (blockinherit .user.agent.template)

	   (block exec

		  (filecon "/usr/bin/setupcon" file file_context))

	   (block home

		  (filecon "HOME_DIR/\.console-setup" file file_context)
		  (filecon "HOME_DIR/\.keyboard" file file_context)

		  (macro user_home_file_type_transition_file ((type ARG1))
			 (call .user.home.file_type_transition
			       (ARG1 file file ".console-setup"))
			 (call .user.home.file_type_transition
			       (ARG1 file file ".keyboard")))

		  (blockinherit .file.macro_template_files)
		  (blockinherit .file.user.home.base_template))

	   (block tmp

		  (macro tmp_file_type_transition_file ((type ARG1))
			 (call .tmp.file_type_transition
			       (ARG1 file file "*")))

		  (blockinherit .file.macro_template_files)
		  (blockinherit .file.user.tmp.base_template))))

(in file.unconfined

    (call .consolesetup.setupcon.home.user_home_file_type_transition_file
	  (typeattr)))

;; TODO: move this to src/user/wheel.cil
;;(in wheel
;;
;;    (call .consolesetup.setupcon.role (role)))
